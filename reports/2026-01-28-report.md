# Audit Report *Lending Security Suite*

**Date:** 2026-01-28  
**Scope:** `protocol/Backend_Lending---Borrowing`  
**Audited components:** LendingPool, Oracle (wrapper), OracleMock, MockUSDC, WETH9  
**Test suite:** Foundry unit tests, invariants and PoCs

## Scope
- `protocol/Backend_Lending---Borrowing/contracts/LendingPool.sol`
- `protocol/Backend_Lending---Borrowing/contracts/Oracle.sol`
- `protocol/Backend_Lending---Borrowing/contracts/OracleMock.sol`
- `protocol/Backend_Lending---Borrowing/contracts/MockUSDC.sol`
- `protocol/Backend_Lending---Borrowing/contracts/WETH9.sol`

Out of scope:
- Oráculos externos DEX/TWAP
- Pools multi‑asset
- Governance/timelocks (on‑chain)
- Servicios off‑chain (bots, UI)

## Methodology
- Revisión manual de la lógica core y access control
- Unit tests para comportamiento esperado y reverts
- Invariant testing con fuzz (HF, debt vs shares)
- PoC-driven security testing para edge cases

## Findings
**No Critical/High findings** en el scope actual del MVP.  
El protocolo se comporta como esperado bajo los escenarios modelados y los tests/PoCs cubren la superficie de riesgo principal.

### Informational / Risk Notes (mejoras posibles en el MVP)
- **Governance centralization risks**: owner puede cambiar oracle/risk params/rate model/reserve factor y usar `rescueToken`.
- **Oracle dependency**: precio stale/invalid puede bloquear acciones (DoS operativo).
- **Operational risk during pause**: liquidations bloqueadas durante un crash.
- **Debt dust / ghost debt**: repay puede dejar residual; el borrowIndex puede hacer que reaparezca deuda visible.
- **Shares dust**: un lender puede retirar todo y quedar con shares residuales inrescatables.
- **Interest-free window (<60s)**: no se cobra interés hasta pasados 60s; puede reducir ingresos si se abusa.
- **Rounding en liquidaciones**: posiciones liquidables pueden fallar por mínimos (dust).

## Proofs of Concept (PoCs)
Ver `lending-security/test/pocs/INDEX.md` para el listado completo. Destacados:
- Oracle manipulation and DoS scenarios
- Liquidation rounding/dust y close-factor griefing
- Bad debt & insolvency path
- Pause semantics y partial repay bajo pausa
- Reentrancy attempt (blocked)
- Governance risks (oracle swap, rate model shock, reserve factor abuse)

## Coverage Matrix (PoCs / Risks)
| Risk / Scenario | Covered | Reference |
|---|---|---|
| Oracle manipulation (price inflate) | Yes | `OracleManipulation.t.sol` |
| Oracle stale / invalid / zero | Yes | `OracleStaleDoS.t.sol`, `OracleInvalidPriceDoS.t.sol`, `OracleZeroOrStale.t.sol` |
| Pause blocks critical functions | Yes | `PauseBypass.t.sol` |
| Pause + partial repay does not restore HF | Yes | `PauseBypass.t.sol` |
| Liquidation rounding / dust | Yes | `LiquidationRounding.t.sol` |
| Close-factor griefing | Yes | `LiquidationRounding.t.sol` |
| Bad debt / insolvency | Yes | `BadDebtInsolvency.t.sol` |
| Bank-run / liquidity risk | Yes | `BadDebtInsolvency.t.sol` |
| Debt dust / ghost debt | Yes | `DebtRoundingDust.t.sol` |
| Shares dust / micro-deposit | Yes | `ShareRoundingDust.t.sol` |
| Interest-free window (<60s) | Yes | `InterestFreeWindow.t.sol` |
| Minute rounding in accrue | Yes | `InterestFreeWindow.t.sol` |
| Governance oracle swap | Yes | `GovernanceOracleSwap.t.sol` |
| Governance risk params | Yes | `GovernanceOracleSwap.t.sol` |
| Rate model shock | Yes | `GovernanceOracleSwap.t.sol` |
| Reserve factor abuse | Yes | `GovernanceReserveFactor.t.sol` |
| RescueToken centralization | Yes | `RescueTokenCentralization.t.sol` |
| Reentrancy attempt | Yes | `ReentrancyAttempt.t.sol` |

## Invariants
- `LendingPool.invariants.t.sol` cubre reglas de health factor y consistencia supply/debt.

## Mitigations / Recommendations
- Usar estrategia de oracle de producción (staleness + multi-source / TWAP)
- Definir procedimientos operativos para pausing vs liquidations
- Considerar governance safeguards (multisig/timelock) para funciones admin
- Documentar comportamiento de dust y rounding edge cases

## Reproducibility
- Unit tests: `forge test`
- Invariants: `forge test --match-path test/LendingPool.invariants.t.sol`
- PoCs: `forge test --match-path test/pocs/*.t.sol`

---

**Status:** Complete para el scope del MVP
